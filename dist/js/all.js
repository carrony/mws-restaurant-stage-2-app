"use strict";navigator.serviceWorker&&navigator.serviceWorker.register("./sw.js",{scope:"./"}).then(function(e){console.log("sevice worker registered")}).catch(function(e){console.log("error registering...")}),function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function u(n,r,o){var u,e=new Promise(function(e,t){i(u=n[r].apply(n,o)).then(e,t)});return e.request=u,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return u(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=u(e,n,arguments)).then(function(e){if(e)return new a(e,t.request)});var e,t})})}function o(e){this._index=e}function a(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function s(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new s(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(a,"_cursor",["direction","key","primaryKey","value"]),t(a,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(a.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new a(e,t._request)})})})}),c.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(c,"_store",["name","keyPath","indexNames","autoIncrement"]),t(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(c,"_store",IDBObjectStore,["deleteIndex"]),s.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},e(s,"_tx",["objectStoreNames","mode"]),n(s,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new s(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(u){[c,o].forEach(function(e){u in e.prototype&&(e.prototype[u.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[u].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var p={open:function(e,t,n){var r=u(indexedDB,"open",[e,t]),o=r.request;return o&&(o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return u(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=p,module.exports.default=module.exports):self.idb=p}();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"fetchRestaurants",value:function(r){var t=idb.open("restauntsDB",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"})});t.then(function(e){return e.transaction("restaurants").objectStore("restaurants").getAll()}).then(function(e){0==e.length?(console.log("no hay datos"),fetch(n.DATABASE_URL).then(function(e){return e.json()}).then(function(n){t.then(function(e){var t=e.transaction("restaurants","readwrite").objectStore("restaurants");n.forEach(function(e){t.put(e)}),r(null,n)})}).catch(function(e){r(e,null)})):r(null,e)})}},{key:"fetchRestaurantById",value:function(r,o){n.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==r});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,o){n.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){n.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,o,u){n.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),u(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){n.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){n.fetchRestaurants(function(e,n){if(e)o(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imagesSrcsetForRestaurant",value:function(e){var t=e.photograph;return t||(t="10"),"/img/"+t+"-small.jpg 250w,\n            /img/"+t+"-medium.jpg 460w,\n            /img/"+t+"-large.jpg 800w"}},{key:"imageSizesForRestaurant",value:function(e){return e?"(max-width: 618px) calc(100vw - 80px), calc(50vw - 80px)":"(max-width: 618px) calc(100vw - 90px), calc(50vw - 90px)"}},{key:"imageUrlForRestaurant",value:function(e){var t=e.photograph;return t||(t="10"),"/img/"+t+"-small.jpg"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),n}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3X3JlZ2lzdGVyLmpzIiwiaWRiLmpzIiwiZGJoZWxwZXIuanMiXSwibmFtZXMiOlsibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwic2NvcGUiLCJ0aGVuIiwicmVnIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJEQkhlbHBlciIsImRiUHJvbWlzZSIsInVwZ3JhZGVEYiIsImtleVBhdGgiLCJyZXN0YXVyYW50cyIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicmVzdGF1cmFudFN0b3JlIiwiZWxlbWVudCIsInB1dCIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiZmlsZW5hbWUiLCJwaG90b2dyYXBoIiwiaW5uZXIiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIl0sIm1hcHBpbmdzIjoiYUFDSUEsVUFBVUMsZUFFVkQsVUFBVUMsY0FBY0MsU0FBUyxVQUFVLENBQ3ZDQyxNQUFPLE9BQ1JDLEtBQUssU0FBU0MsR0FDYkMsUUFBUUMsSUFBSSw4QkFDYkMsTUFB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SUFBSSxTQUFDQyxFQUFHQyxHQUFKLE9BQVVyQixFQUFZcUIsR0FBR0osZUFFekRLLEVBQXNCSixFQUFjSCxPQUFPLFNBQUNLLEVBQUdDLEdBQUosT0FBVUgsRUFBY0ssUUFBUUgsSUFBTUMsSUFDdkZuRCxFQUFTLEtBQU1vRCw0Q0FRQXBELEdBRW5CMEIsRUFBU2EsaUJBQWlCLFNBQUN0RyxFQUFPNkYsR0FDaEMsR0FBSTdGLEVBQ0YrRCxFQUFTL0QsRUFBTyxVQUNYLENBRUwsSUFBTXFILEVBQVd4QixFQUFZbUIsSUFBSSxTQUFDQyxFQUFHQyxHQUFKLE9BQVVyQixFQUFZcUIsR0FBR0wsZUFFcERTLEVBQWlCRCxFQUFTVCxPQUFPLFNBQUNLLEVBQUdDLEdBQUosT0FBVUcsRUFBU0QsUUFBUUgsSUFBTUMsSUFDeEVuRCxFQUFTLEtBQU11RCwrQ0FRR2YsR0FDdEIsTUFBQSx3QkFBZ0NBLEVBQVdGLHFEQU1aRSxHQUUvQixJQUNJZ0IsRUFBV2hCLEVBQVdpQixXQUUxQixPQURLRCxJQUFVQSxFQUFTLE1BQ3hCLFFBQWdCQSxFQUFoQixzQ0FDZUEsRUFEZix1Q0FFZUEsRUFGZixrRUFRNkJFLEdBRTdCLE9BQUlBLEVBQU8sMkRBQ1gseUdBTTJCbEIsR0FFM0IsSUFDSWdCLEVBQVdoQixFQUFXaUIsV0FFMUIsT0FES0QsSUFBVUEsRUFBUyxNQUN4QixRQUFnQkEsRUFBaEIsNERBTTRCaEIsRUFBWVMsR0FReEMsT0FQZSxJQUFJVSxPQUFPQyxLQUFLQyxPQUFPLENBQ3BDQyxTQUFVdEIsRUFBV3VCLE9BQ3JCQyxNQUFPeEIsRUFBVzFCLEtBQ2xCbUQsSUFBS3ZDLEVBQVN3QyxpQkFBaUIxQixHQUMvQlMsSUFBS0EsRUFDTGtCLFVBQVdSLE9BQU9DLEtBQUtRLFVBQVVDLDRDQWhPbkMsTUFBQSIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2ZvciBjb21wYXRpYmxlIGJyb3dzZXJzXHJcbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xyXG4gICAgLy8gUkVnaXN0ZXJpbmcgdGhlIHNlcnZpY2Ugd29ya2VyXHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zdy5qcycse1xyXG4gICAgICAgIHNjb3BlOiAnLi8nXHJcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlZykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdzZXZpY2Ugd29ya2VyIHJlZ2lzdGVyZWQnKVxyXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHJlZ2lzdGVyaW5nLi4uJyk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcblxyXG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8vIC8qKlxyXG4gIC8vICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAvLyAgKi9cclxuICAvLyBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gIC8vICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gIC8vICAgeGhyLm9wZW4oJ0dFVCcsIERCSGVscGVyLkRBVEFCQVNFX1VSTCk7XHJcbiAgLy8gICB4aHIub25sb2FkID0gKCkgPT4ge1xyXG4gIC8vICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7IC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcbiAgLy8gICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XHJcbiAgLy8gICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBqc29uLnJlc3RhdXJhbnRzO1xyXG4gIC8vICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAvLyAgICAgfSBlbHNlIHsgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAvLyAgICAgICBjb25zdCBlcnJvciA9IChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YCk7XHJcbiAgLy8gICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIC8vICAgICB9XHJcbiAgLy8gICB9O1xyXG4gIC8vICAgeGhyLnNlbmQoKTtcclxuICAvLyB9XHJcblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbigncmVzdGF1bnRzREInLCAxLCBmdW5jdGlvbih1cGdyYWRlRGIpIHtcclxuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycgLCB7XHJcbiAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRiUHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRiKSB7XHJcbiAgICAgIC8vIGNyZWF0ZSB0aGUgdHJhbnNhY3Rpb24gaW4gcmVhZC93cml0ZSBvcGVyYXRpb24gYW5kIG9wZW4gdGhlIHN0b3JlIGZvciByZXN0YXVyYW50c1xyXG4gICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKTtcclxuICAgICAgdmFyIHJlc3RhdXJhbnRTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudFN0b3JlLmdldEFsbCgpO1xyXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpe1xyXG4gICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoID09IDAgKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJubyBoYXkgZGF0b3NcIik7XHJcbiAgICAgICAgLy8gTm8gZGF0YSBvbiBCQkRELiBGZXRjaGluZyBmcm9tIG91ciBzZXJ2ZXJcclxuICAgICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN0YXVyYW50cykge1xyXG4gICAgICAgICAgICAvLyBhZGRpbmcgdG8gZGF0YWJhc2VcclxuICAgICAgICAgICAgZGJQcm9taXNlLnRoZW4oIGRiID0+e1xyXG4gICAgICAgICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdGF1cmFudFN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcblxyXG4gICAgICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc3RhdXJhbnRTdG9yZS5wdXQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLG51bGwpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBSZXN0dWFyYW50cyBpbiBEQlxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwscmVzdGF1cmFudHMpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIHNyY3NldCBmb3IgcmVzcG9uc2l2ZXMgaW1hZ2VzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZXNTcmNzZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIC8vIGFkZGluZyBhdHJpYnV0dGVzIGZvciByZXNwb25zaXZlIGltYWdlc1xyXG4gICAgY29uc3QgZXh0ZW5zaW9uPVwianBnXCI7Ly9yZXN0YXVyYW50LnBob3RvZ3JhcGgubWF0Y2goL1xcLihbXi5cXFxcXFwvXSspJC8pLnBvcCgpO1xyXG4gICAgbGV0IGZpbGVuYW1lID0gcmVzdGF1cmFudC5waG90b2dyYXBoOy8vcmVzdGF1cmFudC5waG90b2dyYXBoLnJlcGxhY2UoL1xcLihbXi5cXFxcXFwvXSspJC8sJycpXHJcbiAgICBpZiAoIWZpbGVuYW1lKSBmaWxlbmFtZT1cIjEwXCI7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7ZmlsZW5hbWV9LXNtYWxsLiR7ZXh0ZW5zaW9ufSAyNTB3LFxyXG4gICAgICAgICAgICAvaW1nLyR7ZmlsZW5hbWV9LW1lZGl1bS4ke2V4dGVuc2lvbn0gNDYwdyxcclxuICAgICAgICAgICAgL2ltZy8ke2ZpbGVuYW1lfS1sYXJnZS4ke2V4dGVuc2lvbn0gODAwd2ApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBzcmNzZXQgZm9yIHJlc3BvbnNpdmVzIGltYWdlcy5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTaXplc0ZvclJlc3RhdXJhbnQoaW5uZXIpIHtcclxuICAgIC8vIGFkZGluZyBhdHJpYnV0dGVzIGZvciByZXNwb25zaXZlIGltYWdlc1xyXG4gICAgaWYgKGlubmVyKSByZXR1cm4gYChtYXgtd2lkdGg6IDYxOHB4KSBjYWxjKDEwMHZ3IC0gODBweCksIGNhbGMoNTB2dyAtIDgwcHgpYDtcclxuICAgIHJldHVybiBgKG1heC13aWR0aDogNjE4cHgpIGNhbGMoMTAwdncgLSA5MHB4KSwgY2FsYyg1MHZ3IC0gOTBweClgO1xyXG4gIH1cclxuXHJcbiAgIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2Ugc3Jjc2V0LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgLy8gYWRkaW5nIGF0cmlidXR0ZXMgZm9yIHJlc3BvbnNpdmUgaW1hZ2VzXHJcbiAgICBjb25zdCBleHRlbnNpb249XCJqcGdcIjsvL3Jlc3RhdXJhbnQucGhvdG9ncmFwaC5tYXRjaCgvXFwuKFteLlxcXFxcXC9dKykkLykucG9wKCk7XHJcbiAgICBsZXQgZmlsZW5hbWUgPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7Ly9yZXN0YXVyYW50LnBob3RvZ3JhcGgucmVwbGFjZSgvXFwuKFteLlxcXFxcXC9dKykkLywnJylcclxuICAgIGlmICghZmlsZW5hbWUpIGZpbGVuYW1lPVwiMTBcIjtcclxuICAgIHJldHVybiAoYC9pbWcvJHtmaWxlbmFtZX0tc21hbGwuJHtleHRlbnNpb259YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
